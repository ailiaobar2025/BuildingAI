## 背景
需要对接火山引擎即梦4.0服务，实现文生图与图生图能力，支持多图输入输出、参数定制以及结果轮询，满足高分辨率创作需求。

## 目标
- 提供稳定的任务提交与结果查询 API。
- 支持 prompt、参考图、尺寸、输出数量等核心参数。
- 审核与错误处理可观测，便于运维定位问题。

## 非目标
- 不实现前端 UI 交互逻辑。
- 不实现任务持久化历史查询（留待后续迭代）。

## 架构方案
1. **配置**：在配置模块新增火山引擎凭证（AccessKey、SecretKey）、Region、Service（cv），以及默认 req_key `jimeng_t2i_v40`、重试次数、超时时间。
2. **客户端封装**：若项目已有火山引擎 SDK，扩展新的 client；否则封装 HTTP 模块，统一处理签名、Header、Query 参数。
3. **任务提交流程**：
   - 接口层接受文生图/图生图请求，规范参数。
   - 调用 `CVSync2AsyncSubmitTask`，返回 task_id。
   - 记录任务上下文（可选：写入缓存或数据库以备后续查询）。
4. **任务查询流程**：
   - 根据 task_id 调用 `CVSync2AsyncGetResult`。
   - 若状态为 `in_queue`/`generating`，支持轮询或告知前端稍后重试。
   - `done` 时返回图片链接/Base64；失败时映射错误码并提供友好提示。
5. **安全与合规**：
   - 使用服务端签名，避免在前端暴露密钥。
   - 对 prompt、image_urls 做敏感词过滤及输入校验。
   - 输出的临时 URL 仅用于短期下载，如需长期存储需额外处理。

## 关键决策
- 采用异步任务模式（先提交再查询），与即梦接口设计一致。
- 默认使用 `force_single=false`，允许生成多图；如对延迟敏感可暴露参数给前端选择。
- 错误码 50429/50430 等支持重试，其余错误直接返回。

## 风险与对策
- **鉴权失败**：提前确认凭证权限，提供监控日志。
- **审核不通过**：返回明确错误信息，提示用户调整素材。
- **高并发**：限制调用频率，必要时加入队列或熔断策略。

## 待确认事项
- 是否需要在数据库持久化任务结果。
- 前端是否采用轮询或 Webhook（目前不在 scope 内）。
